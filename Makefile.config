# Do not modify this file! Add a Makefile.local (or export envvars) instead.

ROOTDIR ?= $(shell readlink -f .)

-include $(ROOTDIR)/Makefile.local

# Toolchain options
OSNAME ?= k-os
TOOLCHAINPREFIX ?= build
TARGET ?= i586-elf
BINUTILS_VER ?= 2.30
GMP_VER      ?= 6.1.2
MPFR_VER     ?= 4.0.1
MPC_VER      ?= 1.1.0
GCC_VER      ?= 8.1.0

# Util names
UTILBINPREFIX ?= bin
MKROOTRAMFS ?= mkrootramfs

# Shared names
SHAREDINCPREFIX ?= inc
SHAREDSRCPREFIX ?= src
SHAREDBUILDDIR ?= build

# Main binary output file names
LIBCAR ?= libc.a
KBINARY ?= kernel.elf
ROOTRAMFS ?= rootramfs
IMAGE ?= cdrom.iso
HDD ?= hdd.img

# Emulation options
QEMU ?= qemu-system-i386
CORES ?= 8

########### ABSOLUTELY DO NOT MODIFY BELOW YOU RISK DATA CORRUPTION! ###########
# Calculated constants
TOOLCHAINDIR ?= $(ROOTDIR)/toolchain
UTILDIR ?= $(ROOTDIR)/util
SHAREDDIR ?= $(ROOTDIR)/shared
KERNELDIR ?= $(ROOTDIR)/kernel
LIBDIR ?= $(ROOTDIR)/libc
APPSDIR ?= $(ROOTDIR)/apps
DISTDIR ?= $(ROOTDIR)/dist

TOOLCHAINBINDIR := $(TOOLCHAINDIR)/$(TOOLCHAINPREFIX)
UTILBINDIR := $(UTILDIR)/$(UTILBINPREFIX)
SHAREDINCDIR := $(SHAREDDIR)/$(SHAREDBUILDDIR)/$(SHAREDINCPREFIX)
SHAREDSRCDIR := $(SHAREDDIR)/$(SHAREDBUILDDIR)/$(SHAREDSRCPREFIX)

QEMUARGS ?= -smp cores=$(CORES) -boot d -cdrom $(DISTDIR)/$(IMAGE) -drive id=disk,format=raw,file=$(HDD),if=none -device ahci,id=ahci -device ide-drive,drive=disk,bus=ahci.0 -netdev user,id=network0 -device e1000,netdev=network0

# Required tools
WGET ?= wget
TAR ?= tar
KAR := $(TOOLCHAINBINDIR)/bin/$(TARGET)-ar
KAS := $(TOOLCHAINBINDIR)/bin/$(TARGET)-as
KLD := $(TOOLCHAINBINDIR)/bin/$(TARGET)-ld
KCPP := $(TOOLCHAINBINDIR)/bin/$(TARGET)-cpp
KCC := $(TOOLCHAINBINDIR)/bin/$(TARGET)-gcc
