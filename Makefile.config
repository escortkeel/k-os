# Do not modify this file! Add a Makefile.local (or export envvars) instead.

ROOTDIR ?= $(shell readlink -f .)

-include $(ROOTDIR)/Makefile.local

# Toolchain options
OSNAME ?= k-os
TOOLCHAINPREFIX ?= dist
TARGET ?= i586-kos
BINUTILS_VER  ?= 2.30
GMP_VER       ?= 6.1.2
MPFR_VER      ?= 4.0.1
MPC_VER       ?= 1.1.0
GCC_VER       ?= 8.1.0

# These versions CANNOT be higher: automake requires perl version <= 5.22,
# and binutils/gcc/newlib needs these versions of automake and autoconf.
PERL_VER      ?= 5.22.2
AUTOCONF_VER  ?= 2.64
AUTOMAKE_VER  ?= 1.11.6

# libc options
NEWLIB_VER    ?= 3.0.0

# Names
UTILBINPREFIX ?= bin
MKROOTRAMFS ?= mkrootramfs

SHAREDINCPREFIX ?= inc
SHAREDSRCPREFIX ?= src
SHAREDBUILDDIR ?= build

LIBCPREFIX ?= dist
LIBKPREFIX ?= dist

KSYSROOTPREFIX ?= sysroot
KSYSLIBPREFIX ?= lib
KSYSHEADERPREFIX ?= include

DISTIMAGEPREFIX ?= image

# Main binary output file names
LIBKAR ?= libk.a
KBINARY ?= kernel.elf
ROOTRAMFS ?= rootramfs
IMAGE ?= cdrom.iso
HDD ?= hdd.img

# Emulation options
QEMU ?= qemu-system-i386
CORES ?= 2

########### ABSOLUTELY DO NOT MODIFY BELOW YOU RISK DATA CORRUPTION! ###########
# Calculated constants
TOOLCHAINDIR ?= $(ROOTDIR)/toolchain
UTILDIR ?= $(ROOTDIR)/util
SHAREDDIR ?= $(ROOTDIR)/shared
KERNELDIR ?= $(ROOTDIR)/kernel
LIBKDIR ?= $(ROOTDIR)/libk
LIBCDIR ?= $(ROOTDIR)/libc
APPSDIR ?= $(ROOTDIR)/apps
DISTDIR ?= $(ROOTDIR)/dist

TOOLCHAINBINDIR := $(TOOLCHAINDIR)/$(TOOLCHAINPREFIX)
UTILBINDIR := $(UTILDIR)/$(UTILBINPREFIX)
SHAREDINCDIR := $(SHAREDDIR)/$(SHAREDBUILDDIR)/$(SHAREDINCPREFIX)
SHAREDSRCDIR := $(SHAREDDIR)/$(SHAREDBUILDDIR)/$(SHAREDSRCPREFIX)
LIBKBINDIR := $(LIBKDIR)/$(LIBKPREFIX)
LIBCBINDIR := $(LIBCDIR)/$(LIBCPREFIX)
LIBCSYSDIR := $(LIBCBINDIR)/$(TARGET)
LIBCHEADERDIR := $(LIBCSYSDIR)/include

KSYSROOT := $(DISTDIR)/$(KSYSROOTPREFIX)
KSYSSTARTDIR := $(KSYSROOT)/$(KSYSLIBPREFIX)
KSYSLIBDIR := $(KSYSROOT)/$(KSYSLIBPREFIX)
KSYSHEADERDIR := $(KSYSROOT)/$(KSYSHEADERPREFIX)

QEMUARGS ?= -smp cores=$(CORES) -boot d -cdrom $(DISTDIR)/$(DISTIMAGEPREFIX)/$(IMAGE) -drive id=disk,format=raw,file=$(HDD),if=none -device ahci,id=ahci -device ide-drive,drive=disk,bus=ahci.0 -netdev user,id=network0 -device e1000,netdev=network0

# Required tools
WGET ?= wget
TAR ?= tar
KAR := $(TOOLCHAINBINDIR)/bin/$(TARGET)-ar
KAS := $(TOOLCHAINBINDIR)/bin/$(TARGET)-as
KLD := $(TOOLCHAINBINDIR)/bin/$(TARGET)-ld
KCPP := $(TOOLCHAINBINDIR)/bin/$(TARGET)-cpp
KCC := $(TOOLCHAINBINDIR)/bin/$(TARGET)-gcc
